<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat with Nicknames</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      #chat {
        width: 300px;
        height: 300px;
        border: 1px solid #ccc;
        overflow-y: scroll;
        margin: 10px auto;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h2>Real-Time Chat with Nicknames</h2>

    <input type="text" id="nickname" placeholder="Enter your nickname..." />
    <button onclick="setNickname()">Set Nickname</button>

    <div id="chat"></div>

    <input type="text" id="message" placeholder="Type a message..." disabled />
    <button onclick="sendMessage()" disabled>Send</button>

    <script>
      const socket = new WebSocket(
        "wss://chatapp-production-136a.up.railway.app"
      );

      let nickname = "";

      function setNickname() {
        const input = document.getElementById("nickname");
        nickname = input.value.trim();

        if (nickname) {
          socket.send(JSON.stringify({ type: "set_nickname", nickname }));
          input.disabled = true;
          document.getElementById("message").disabled = false;
          document.querySelector(
            "button[onclick='sendMessage()']"
          ).disabled = false;
        }
      }

      socket.onmessage = async (event) => {
        const chatDiv = document.getElementById("chat");
        const messageElement = document.createElement("p");

        if (event.data instanceof Blob) {
          const text = await event.data.text(); // Convert Blob to string
          messageElement.textContent = text;
        } else {
          messageElement.textContent = event.data; // If already a string
        }

        chatDiv.appendChild(messageElement);
      };

      function sendMessage() {
        const messageInput = document.getElementById("message");
        const message = messageInput.value.trim();

        if (message) {
          socket.send(JSON.stringify({ type: "message", message }));
          messageInput.value = "";
        }
      }
    </script>
  </body>
</html>
